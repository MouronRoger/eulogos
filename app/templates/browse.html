{% extends "base.html" %}

{% block title %}Browse Texts - Eulogos{% endblock %}

{% block content %}
<div class="flex space-x-6">
    <!-- Filtering sidebar -->
    <div class="w-64 flex-shrink-0">
        <div class="bg-white shadow rounded-lg p-4">
            <h2 class="text-lg font-semibold mb-4">Filters</h2>
            
            <!-- Era filter -->
            <div class="mb-4">
                <h3 class="font-medium text-gray-700 mb-2">Era</h3>
                <div class="space-y-2">
                    {% for era in ['Pre-Socratic', 'Hellenistic', 'Imperial', 'Late Antiquity'] %}
                    <label class="flex items-center">
                        <input
                            type="checkbox"
                            name="era"
                            value="{{ era|lower }}"
                            class="rounded text-blue-600"
                            hx-get="/api/v2/browse"
                            hx-trigger="change"
                            hx-target="#author-list"
                            hx-include="[name='era']"
                        >
                        <span class="ml-2 text-sm text-gray-700">{{ era }}</span>
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- Status filter -->
            <div class="mb-4">
                <h3 class="font-medium text-gray-700 mb-2">Status</h3>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input
                            type="radio"
                            name="status"
                            value="all"
                            checked
                            class="text-blue-600"
                            hx-get="/api/v2/browse"
                            hx-trigger="change"
                            hx-target="#author-list"
                        >
                        <span class="ml-2 text-sm text-gray-700">All</span>
                    </label>
                    <label class="flex items-center">
                        <input
                            type="radio"
                            name="status"
                            value="favorites"
                            class="text-blue-600"
                            hx-get="/api/v2/browse"
                            hx-trigger="change"
                            hx-target="#author-list"
                        >
                        <span class="ml-2 text-sm text-gray-700">Favorites</span>
                    </label>
                    <label class="flex items-center">
                        <input
                            type="radio"
                            name="status"
                            value="archived"
                            class="text-blue-600"
                            hx-get="/api/v2/browse"
                            hx-trigger="change"
                            hx-target="#author-list"
                        >
                        <span class="ml-2 text-sm text-gray-700">Archived</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Author list -->
    <div class="flex-grow">
        <div id="author-list" class="space-y-6">
    {% for author in authors %}
            <div class="bg-white shadow rounded-lg p-6" x-data="{ expanded: false }">
                <div class="flex items-center justify-between cursor-pointer" @click="expanded = !expanded">
                    <h2 class="text-xl font-semibold text-gray-900">
                        {{ author.name }}
                        <span class="text-sm text-gray-500">
                            ({{ author.id }}{% if author.century %}, {{ author.century }} century{% endif %}{% if author.type %}, {{ author.type }}{% endif %})
                        </span>
        </h2>
                    <svg
                        class="w-6 h-6 text-gray-500 transform transition-transform"
                        :class="{ 'rotate-180': expanded }"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>

                <div x-show="expanded" x-collapse>
        {% for work in author.works %}
                    <div class="mt-4 pl-4 border-l-2 border-gray-200">
                        <div x-data="{ workExpanded: false }">
                            <div class="flex items-center justify-between cursor-pointer" @click="workExpanded = !workExpanded">
                                <h3 class="text-lg font-medium text-gray-900">
                                    {{ work.title }}
                                    <span class="text-sm text-gray-500">({{ work.id }})</span>
                                </h3>
                                <svg
                                    class="w-5 h-5 text-gray-500 transform transition-transform"
                                    :class="{ 'rotate-180': workExpanded }"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </div>

                            <div x-show="workExpanded" x-collapse>
            {% if work.editions %}
                                <div class="mt-2 pl-4">
                                    <h4 class="text-sm font-medium text-gray-700">Editions:</h4>
                {% for edition in work.editions %}
                                    <div class="mt-2 p-2 bg-gray-50 rounded {% if edition.archived %}opacity-50{% endif %} {% if edition.favorite %}bg-yellow-50{% endif %}">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <strong class="text-gray-900">{{ edition.label }}</strong>
                                                <span class="text-sm text-gray-500">({{ edition.id }}, {{ edition.language }})</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <a
                                                    href="/read/{{ edition.path }}"
                                                    class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
                                                >
                                                    Read
                                                </a>
                                                <a
                                                    href="/data/{{ edition.path }}?raw=true"
                                                    class="px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700"
                                                    target="_blank"
                                                >
                                                    XML
                                                </a>
                                            </div>
                                        </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if work.translations %}
                                <div class="mt-4 pl-4">
                                    <h4 class="text-sm font-medium text-gray-700">Translations:</h4>
                {% for translation in work.translations %}
                                    <div class="mt-2 p-2 bg-gray-50 rounded {% if translation.archived %}opacity-50{% endif %} {% if translation.favorite %}bg-yellow-50{% endif %}">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <strong class="text-gray-900">{{ translation.label }}</strong>
                                                <span class="text-sm text-gray-500">({{ translation.id }}, {{ translation.language }})</span>
                                            </div>
                                            <div class="flex space-x-2">
                                                <a
                                                    href="/read/{{ translation.path }}"
                                                    class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
                                                >
                                                    Read
                                                </a>
                                                <a
                                                    href="/data/{{ translation.path }}?raw=true"
                                                    class="px-3 py-1 bg-gray-600 text-white text-sm rounded hover:bg-gray-700"
                                                    target="_blank"
                                                >
                                                    XML
                                                </a>
                                            </div>
                                        </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
        </div>
        {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
